import { Component, Input } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./stageformatter.pipe";
export class NgxStepComponent {
    constructor() {
        this.updateProgressLogs = [];
        this.stages = [1, 2, 3, 4, 5];
        this.jobOverallStatus = 'NOT_STARTED'; // Possible Values- NOT_STARTED , ACTIVE, COMPLETED, FAILED
        this.options = {
            type: 'BASIC',
            excludeFirstEntry: false,
            showLogs: false,
            finalStageName: 'FINISH',
            isMultiWordStageName: false,
            textSeparator: '_'
        };
        this.states = [];
    }
    ngOnChanges(changes) {
        this.ngOnInit();
    }
    ngOnInit() {
        this.generateStages();
    }
    generateStages() {
        if (this.options.type === 'CUSTOM') {
            let result = this.groupBy(this.updateProgressLogs.updateInfo, (obj) => obj.stage);
            if (this.states.length > 0) {
                this.states = []; //reset previous states data 
            }
            this.stages.forEach((item, index) => {
                var element = item.name;
                if (element in result) {
                    let stageStatus = result[element][result[element].length - 1].status;
                    this.states.push({ 'name': element, 'status': stageStatus });
                }
                else {
                    // Then take the value from the updateInfo object
                    if (index <= 0) {
                        this.states.push({ 'name': element, 'status': 'IN_PROGRESS' });
                    }
                    else {
                        // Check if previous stage of not found element is completed then make the not found stage at position 'index' status as IN_PROGRESS else 'NOT_STARTED'.
                        var previousStateStatus = this.states[index - 1].status;
                        var newStatusForNotFoundStage = previousStateStatus === 'COMPLETED' ? 'IN_PROGRESS' : 'NOT_STARTED';
                        this.states.push({ 'name': element, 'status': newStatusForNotFoundStage });
                    }
                }
            });
        }
    }
    groupBy(array, key) {
        const keyFn = key instanceof Function ? key : (obj) => obj[key];
        return array.reduce((objectsByKeyValue, obj) => {
            const value = keyFn(obj);
            objectsByKeyValue[value] = (objectsByKeyValue[value] || []).concat(obj);
            return objectsByKeyValue;
        }, {});
    }
}
NgxStepComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: NgxStepComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
NgxStepComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: NgxStepComponent, selector: "ngx-step", inputs: { updateProgressLogs: "updateProgressLogs", stages: "stages", jobOverallStatus: "jobOverallStatus", options: "options" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"row mt-2\" style=\"overflow: hidden !important;\" *ngIf=\"options.type === 'BASIC'\">\r\n    <div class=\"col-md-12 col-sm-12 job-progress-bar p-0 bg-white\">\r\n        <div class=\"track\" *ngIf=\"stages.length >0\">\r\n            <div class=\"step\" [ngClass]=\"state.status\" *ngFor=\"let state of stages; let i = index\">\r\n                <span class=\"icon\"> <em class=\"fas\" [ngClass]=\"{\r\n                    'fa-check': state.status === 'COMPLETED',\r\n                    'fa-sync fa-spin': state.status === 'IN_PROGRESS',\r\n                    'fa-times': state.status === 'FAILED',\r\n                    'fa-circle': state.status === 'NOT_STARTED'\r\n                }\"></em> </span>\r\n                <span class=\"text\" *ngIf=\"options.isMultiWordStageName\">{{state.name | formatText : options.textSeparator}}</span>\r\n                <span class=\"text\" *ngIf=\"!options.isMultiWordStageName\">{{state.name}}</span>\r\n\r\n            </div>\r\n            <div class=\"step\">\r\n                <span class=\"icon\"\r\n                    [ngClass]=\"{'job-success': (jobOverallStatus === 'COMPLETED'  && stages[this.stages.length - 1].status === 'COMPLETED' ), 'text-white': (jobOverallStatus === 'ACTIVE' || jobOverallStatus === 'FAILED')}\">\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'FAILED' || jobOverallStatus === 'COMPLETED'\"></em>\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && stages[this.stages.length - 1].status != 'COMPLETED'  \"></em>\r\n                    <em class=\"fa fa-cog fa-spin text-muted\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && stages[this.stages.length - 1].status === 'COMPLETED' \"></em>\r\n                </span>\r\n                <span class=\"text\"> {{options.finalStageName}} </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"row mt-2\" style=\"overflow: hidden !important;\" *ngIf=\"options.type === 'CUSTOM'\">\r\n    <div class=\"col-md-12 col-sm-12 job-progress-bar p-0 bg-white\">\r\n        <div class=\"track\" *ngIf=\"states.length >0\">\r\n            <div class=\"step\" [ngClass]=\"state.status\" *ngFor=\"let state of states; let i = index\">\r\n                <span class=\"icon\"> <em class=\"fas\" [ngClass]=\"{\r\n                    'fa-check': state.status === 'COMPLETED',\r\n                    'fa-sync fa-spin': state.status === 'IN_PROGRESS',\r\n                    'fa-times': state.status === 'FAILED',\r\n                    'fa-circle': state.status === 'NOT_STARTED'\r\n                }\"></em> </span>\r\n                <span class=\"text\" *ngIf=\"options.isMultiWordStageName\">{{state.name | formatText : options.textSeparator}}</span>\r\n                <span class=\"text\" *ngIf=\"!options.isMultiWordStageName\">{{state.name}}</span>\r\n            </div>\r\n            <div class=\"step\">\r\n                <span class=\"icon\"\r\n                    [ngClass]=\"{\r\n                        'job-success': (jobOverallStatus === 'COMPLETED' && states[this.states.length - 1].status === 'COMPLETED' ), \r\n                        'text-white': (jobOverallStatus === 'ACTIVE'),\r\n                        'job-failed': (jobOverallStatus === 'FAILED')\r\n                    }\">\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'COMPLETED'\"></em>\r\n                    <em class=\"fa fa-times\"\r\n                        *ngIf=\"jobOverallStatus === 'FAILED'\"></em>\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && states[this.states.length - 1].status != 'COMPLETED'  \"></em>\r\n                    <em class=\"fa fa-cog fa-spin text-muted\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && states[this.states.length - 1].status === 'COMPLETED' \"></em>\r\n                </span>\r\n                <span class=\"text\"> {{options.finalStageName}} </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- If user wants Logs to display -->\r\n<div class=\"row mt-2\"  *ngIf=\"options.showLogs\">\r\n    <div class=\"col-md-12\">\r\n        <div class=\"shadow-none\">\r\n            <div class=\"card-header\">\r\n                <h3 class=\"card-title\">Events and Logs</h3>\r\n            </div>\r\n            <div class=\"card-body p-0 elevation-1 table-responsive\">\r\n            </div>\r\n            <div class=\"card-footer\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>", styles: [".wd-100px{width:100px}.wd-150px{width:150px}.label-name{font-weight:500}:host ::ng-deep .last-edited-step-1 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-1 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):after,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(9):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(9):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(11):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(13):before{border-top-color:#7e8a8a!important}.track{position:relative;display:flex;margin-bottom:40px;margin-top:50px}.track .step{flex-grow:1;width:25%;margin-top:-13px;text-align:center;position:relative}.track .step.active:before{background:#FF5722}.track .step:before{height:5px;position:absolute;content:\"\";width:100%;top:13px}.track .step.active .icon{background:#ee5435;color:#fff}.track .icon{display:inline-block;width:30px;height:30px;line-height:30px;position:relative;border-radius:100%;background:#ddd}.track .step.active .text{font-weight:400;color:#000}.track .text{display:block;margin-top:7px;font-size:12px}.track .step.COMPLETED:before{background:#16b587}.track .step.COMPLETED .icon{background:#16b587;color:#fff}.track .step.COMPLETED .text{font-weight:400;color:#000}.track .step.FAILED:before{background:#f40c48}.track .step.FAILED .icon{background:#f40c48;color:#fff}.track .step.FAILED .text{font-weight:400;color:#f40c48}.track .step.IN_PROGRESS:before{background:#eab417}.track .step.IN_PROGRESS .icon{background:#eab417;color:#fff}.track .step.IN_PROGRESS .text{font-weight:500;color:#000}.track .step.NOT_STARTED:before{background:#dddddd}.track .step.NOT_STARTED .icon{color:#fff}.track .step.NOT_STARTED .text{font-weight:400;color:#6c757d}.job-success{background:#16b587!important;color:#fff}.job-failed{background:#f40c48!important;color:#fff}.removed-node{opacity:.3}.job-create{background-color:#1eb980;text-transform:uppercase}.job-delete{background-color:#f8d7da;text-transform:uppercase}.job-upgrade{background-color:#eab417;text-transform:uppercase}.job-scaleup{background-color:#015a92;text-transform:uppercase;color:#fff}.job-scale-down{background-color:#ccc;text-transform:uppercase}\n"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], pipes: { "formatText": i2.StageFormatterPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: NgxStepComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngx-step',
                    templateUrl: 'ngx-step.html',
                    styleUrls: ['ngx-step.css']
                }]
        }], ctorParameters: function () { return []; }, propDecorators: { updateProgressLogs: [{
                type: Input
            }], stages: [{
                type: Input
            }], jobOverallStatus: [{
                type: Input
            }], options: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXN0ZXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXN0ZXAvc3JjL2xpYi9uZ3gtc3RlcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc3RlcC9zcmMvbGliL25neC1zdGVwLmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQXNDLE1BQU0sZUFBZSxDQUFDOzs7O0FBUTdGLE1BQU0sT0FBTyxnQkFBZ0I7SUFlM0I7UUFkUyx1QkFBa0IsR0FBUSxFQUFFLENBQUU7UUFDOUIsV0FBTSxHQUFRLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLHFCQUFnQixHQUFRLGFBQWEsQ0FBQyxDQUFDLDJEQUEyRDtRQUNsRyxZQUFPLEdBQU87WUFDckIsSUFBSSxFQUFFLE9BQU87WUFDYixpQkFBaUIsRUFBRSxLQUFLO1lBQ3hCLFFBQVEsRUFBRSxLQUFLO1lBQ2YsY0FBYyxFQUFFLFFBQVE7WUFDeEIsb0JBQW9CLEVBQUcsS0FBSztZQUM1QixhQUFhLEVBQUUsR0FBRztTQUNuQixDQUFDO1FBRUYsV0FBTSxHQUFRLEVBQUUsQ0FBQztJQUVELENBQUM7SUFDakIsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQsY0FBYztRQUNaLElBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssUUFBUSxFQUFDO1lBQ2hDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxDQUFDLEdBQU8sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RGLElBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFDO2dCQUN4QixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQyxDQUFDLDZCQUE2QjthQUNoRDtZQUNELElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBUSxFQUFFLEtBQVMsRUFBRSxFQUFFO2dCQUMxQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFFO2dCQUN6QixJQUFHLE9BQU8sSUFBSSxNQUFNLEVBQUM7b0JBQ25CLElBQUksV0FBVyxHQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxHQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztvQkFDcEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBQyxNQUFNLEVBQUMsT0FBTyxFQUFDLFFBQVEsRUFBQyxXQUFXLEVBQUMsQ0FBQyxDQUFDO2lCQUN6RDtxQkFBSTtvQkFDSCxpREFBaUQ7b0JBQ2pELElBQUcsS0FBSyxJQUFJLENBQUMsRUFBQzt3QkFDWixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFDLE1BQU0sRUFBQyxPQUFPLEVBQUMsUUFBUSxFQUFDLGFBQWEsRUFBQyxDQUFDLENBQUM7cUJBQzNEO3lCQUFJO3dCQUNILHdKQUF3Sjt3QkFDdkosSUFBSSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7d0JBQ3RELElBQUkseUJBQXlCLEdBQUcsbUJBQW1CLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQzt3QkFDcEcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBQyxNQUFNLEVBQUMsT0FBTyxFQUFDLFFBQVEsRUFBQyx5QkFBeUIsRUFBQyxDQUFDLENBQUM7cUJBQ3RFO2lCQUNKO1lBQ0gsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFFRCxPQUFPLENBQUMsS0FBUyxFQUFFLEdBQU87UUFDeEIsTUFBTSxLQUFLLEdBQUcsR0FBRyxZQUFZLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQU8sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BFLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGlCQUFxQixFQUFFLEdBQU8sRUFBRSxFQUFFO1lBQ3JELE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN6QixpQkFBaUIsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN4RSxPQUFPLGlCQUFpQixDQUFDO1FBQzNCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNULENBQUM7OzhHQXpEVSxnQkFBZ0I7a0dBQWhCLGdCQUFnQix1TUNSN0IscW9KQTZFTTs0RkRyRU8sZ0JBQWdCO2tCQUw1QixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxVQUFVO29CQUNwQixXQUFXLEVBQUUsZUFBZTtvQkFDNUIsU0FBUyxFQUFFLENBQUMsY0FBYyxDQUFDO2lCQUM1QjswRUFFVSxrQkFBa0I7c0JBQTFCLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLGdCQUFnQjtzQkFBeEIsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE9uQ2hhbmdlcyxWaWV3Q2hpbGQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtc3RlcCcsXG4gIHRlbXBsYXRlVXJsOiAnbmd4LXN0ZXAuaHRtbCcsXG4gIHN0eWxlVXJsczogWyduZ3gtc3RlcC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hTdGVwQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgdXBkYXRlUHJvZ3Jlc3NMb2dzOiBhbnkgPSBbXSA7XG4gIEBJbnB1dCgpIHN0YWdlcyA6YW55ID0gWzEsMiwzLDQsNV07XG4gIEBJbnB1dCgpIGpvYk92ZXJhbGxTdGF0dXMgOmFueSA9ICdOT1RfU1RBUlRFRCc7IC8vIFBvc3NpYmxlIFZhbHVlcy0gTk9UX1NUQVJURUQgLCBBQ1RJVkUsIENPTVBMRVRFRCwgRkFJTEVEXG4gIEBJbnB1dCgpIG9wdGlvbnM6YW55ID0ge1xuICAgIHR5cGU6ICdCQVNJQycsLy9DVVNUT00gLSB5b3UgbmVlZCB0byBnZW5lcmF0ZSBzdGFnZXMgYW5kIGl0c1xuICAgIGV4Y2x1ZGVGaXJzdEVudHJ5OiBmYWxzZSxcbiAgICBzaG93TG9nczogZmFsc2UsXG4gICAgZmluYWxTdGFnZU5hbWU6ICdGSU5JU0gnLFxuICAgIGlzTXVsdGlXb3JkU3RhZ2VOYW1lIDogZmFsc2UsXG4gICAgdGV4dFNlcGFyYXRvcjogJ18nXG4gIH07XG5cbiAgc3RhdGVzOiBhbnkgPSBbXTtcbiAgXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICB0aGlzLm5nT25Jbml0KCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmdlbmVyYXRlU3RhZ2VzKCk7XG4gIH1cblxuICBnZW5lcmF0ZVN0YWdlcygpe1xuICAgIGlmKHRoaXMub3B0aW9ucy50eXBlID09PSAnQ1VTVE9NJyl7XG4gICAgICBsZXQgcmVzdWx0ID0gdGhpcy5ncm91cEJ5KHRoaXMudXBkYXRlUHJvZ3Jlc3NMb2dzLnVwZGF0ZUluZm8sIChvYmo6YW55KSA9PiBvYmouc3RhZ2UpO1xuICAgICAgaWYodGhpcy5zdGF0ZXMubGVuZ3RoID4gMCl7XG4gICAgICAgIHRoaXMuc3RhdGVzID0gW107IC8vcmVzZXQgcHJldmlvdXMgc3RhdGVzIGRhdGEgXG4gICAgICB9XG4gICAgICB0aGlzLnN0YWdlcy5mb3JFYWNoKChpdGVtOmFueSwgaW5kZXg6YW55KSA9PiB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gaXRlbS5uYW1lIDtcbiAgICAgICAgaWYoZWxlbWVudCBpbiByZXN1bHQpe1xuICAgICAgICAgIGxldCBzdGFnZVN0YXR1cyA9ICByZXN1bHRbZWxlbWVudF1bcmVzdWx0W2VsZW1lbnRdLmxlbmd0aC0xXS5zdGF0dXM7XG4gICAgICAgICAgdGhpcy5zdGF0ZXMucHVzaCh7J25hbWUnOmVsZW1lbnQsJ3N0YXR1cyc6c3RhZ2VTdGF0dXN9KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgLy8gVGhlbiB0YWtlIHRoZSB2YWx1ZSBmcm9tIHRoZSB1cGRhdGVJbmZvIG9iamVjdFxuICAgICAgICAgIGlmKGluZGV4IDw9IDApe1xuICAgICAgICAgICAgdGhpcy5zdGF0ZXMucHVzaCh7J25hbWUnOmVsZW1lbnQsJ3N0YXR1cyc6J0lOX1BST0dSRVNTJ30pO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgcHJldmlvdXMgc3RhZ2Ugb2Ygbm90IGZvdW5kIGVsZW1lbnQgaXMgY29tcGxldGVkIHRoZW4gbWFrZSB0aGUgbm90IGZvdW5kIHN0YWdlIGF0IHBvc2l0aW9uICdpbmRleCcgc3RhdHVzIGFzIElOX1BST0dSRVNTIGVsc2UgJ05PVF9TVEFSVEVEJy5cbiAgICAgICAgICAgICB2YXIgcHJldmlvdXNTdGF0ZVN0YXR1cyA9IHRoaXMuc3RhdGVzW2luZGV4LTFdLnN0YXR1cztcbiAgICAgICAgICAgICB2YXIgbmV3U3RhdHVzRm9yTm90Rm91bmRTdGFnZSA9IHByZXZpb3VzU3RhdGVTdGF0dXMgPT09ICdDT01QTEVURUQnID8gJ0lOX1BST0dSRVNTJyA6ICdOT1RfU1RBUlRFRCc7IFxuICAgICAgICAgICAgIHRoaXMuc3RhdGVzLnB1c2goeyduYW1lJzplbGVtZW50LCdzdGF0dXMnOm5ld1N0YXR1c0Zvck5vdEZvdW5kU3RhZ2V9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ3JvdXBCeShhcnJheTphbnksIGtleTphbnkpIHtcbiAgICBjb25zdCBrZXlGbiA9IGtleSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8ga2V5IDogKG9iajphbnkpID0+IG9ialtrZXldO1xuICAgIHJldHVybiBhcnJheS5yZWR1Y2UoKG9iamVjdHNCeUtleVZhbHVlOmFueSwgb2JqOmFueSkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBrZXlGbihvYmopO1xuICAgICAgb2JqZWN0c0J5S2V5VmFsdWVbdmFsdWVdID0gKG9iamVjdHNCeUtleVZhbHVlW3ZhbHVlXSB8fCBbXSkuY29uY2F0KG9iaik7XG4gICAgICByZXR1cm4gb2JqZWN0c0J5S2V5VmFsdWU7XG4gICAgfSwge30pO1xuICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJyb3cgbXQtMlwiIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbiAhaW1wb3J0YW50O1wiICpuZ0lmPVwib3B0aW9ucy50eXBlID09PSAnQkFTSUMnXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTEyIGNvbC1zbS0xMiBqb2ItcHJvZ3Jlc3MtYmFyIHAtMCBiZy13aGl0ZVwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0cmFja1wiICpuZ0lmPVwic3RhZ2VzLmxlbmd0aCA+MFwiPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RlcFwiIFtuZ0NsYXNzXT1cInN0YXRlLnN0YXR1c1wiICpuZ0Zvcj1cImxldCBzdGF0ZSBvZiBzdGFnZXM7IGxldCBpID0gaW5kZXhcIj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaWNvblwiPiA8ZW0gY2xhc3M9XCJmYXNcIiBbbmdDbGFzc109XCJ7XHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZhLWNoZWNrJzogc3RhdGUuc3RhdHVzID09PSAnQ09NUExFVEVEJyxcclxuICAgICAgICAgICAgICAgICAgICAnZmEtc3luYyBmYS1zcGluJzogc3RhdGUuc3RhdHVzID09PSAnSU5fUFJPR1JFU1MnLFxyXG4gICAgICAgICAgICAgICAgICAgICdmYS10aW1lcyc6IHN0YXRlLnN0YXR1cyA9PT0gJ0ZBSUxFRCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZhLWNpcmNsZSc6IHN0YXRlLnN0YXR1cyA9PT0gJ05PVF9TVEFSVEVEJ1xyXG4gICAgICAgICAgICAgICAgfVwiPjwvZW0+IDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiICpuZ0lmPVwib3B0aW9ucy5pc011bHRpV29yZFN0YWdlTmFtZVwiPnt7c3RhdGUubmFtZSB8IGZvcm1hdFRleHQgOiBvcHRpb25zLnRleHRTZXBhcmF0b3J9fTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiICpuZ0lmPVwiIW9wdGlvbnMuaXNNdWx0aVdvcmRTdGFnZU5hbWVcIj57e3N0YXRlLm5hbWV9fTwvc3Bhbj5cclxuXHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RlcFwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpY29uXCJcclxuICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7J2pvYi1zdWNjZXNzJzogKGpvYk92ZXJhbGxTdGF0dXMgPT09ICdDT01QTEVURUQnICAmJiBzdGFnZXNbdGhpcy5zdGFnZXMubGVuZ3RoIC0gMV0uc3RhdHVzID09PSAnQ09NUExFVEVEJyApLCAndGV4dC13aGl0ZSc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnQUNUSVZFJyB8fCBqb2JPdmVyYWxsU3RhdHVzID09PSAnRkFJTEVEJyl9XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY2xpcGJvYXJkLWNoZWNrXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJqb2JPdmVyYWxsU3RhdHVzID09PSAnRkFJTEVEJyB8fCBqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJ1wiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY2xpcGJvYXJkLWNoZWNrXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJqb2JPdmVyYWxsU3RhdHVzID09PSAnQUNUSVZFJyAmJiBzdGFnZXNbdGhpcy5zdGFnZXMubGVuZ3RoIC0gMV0uc3RhdHVzICE9ICdDT01QTEVURUQnICBcIj48L2VtPlxyXG4gICAgICAgICAgICAgICAgICAgIDxlbSBjbGFzcz1cImZhIGZhLWNvZyBmYS1zcGluIHRleHQtbXV0ZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdBQ1RJVkUnICYmIHN0YWdlc1t0aGlzLnN0YWdlcy5sZW5ndGggLSAxXS5zdGF0dXMgPT09ICdDT01QTEVURUQnIFwiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHRcIj4ge3tvcHRpb25zLmZpbmFsU3RhZ2VOYW1lfX0gPC9zcGFuPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG48L2Rpdj5cclxuXHJcbjxkaXYgY2xhc3M9XCJyb3cgbXQtMlwiIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbiAhaW1wb3J0YW50O1wiICpuZ0lmPVwib3B0aW9ucy50eXBlID09PSAnQ1VTVE9NJ1wiPlxyXG4gICAgPGRpdiBjbGFzcz1cImNvbC1tZC0xMiBjb2wtc20tMTIgam9iLXByb2dyZXNzLWJhciBwLTAgYmctd2hpdGVcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwidHJhY2tcIiAqbmdJZj1cInN0YXRlcy5sZW5ndGggPjBcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN0ZXBcIiBbbmdDbGFzc109XCJzdGF0ZS5zdGF0dXNcIiAqbmdGb3I9XCJsZXQgc3RhdGUgb2Ygc3RhdGVzOyBsZXQgaSA9IGluZGV4XCI+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImljb25cIj4gPGVtIGNsYXNzPVwiZmFzXCIgW25nQ2xhc3NdPVwie1xyXG4gICAgICAgICAgICAgICAgICAgICdmYS1jaGVjayc6IHN0YXRlLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZhLXN5bmMgZmEtc3Bpbic6IHN0YXRlLnN0YXR1cyA9PT0gJ0lOX1BST0dSRVNTJyxcclxuICAgICAgICAgICAgICAgICAgICAnZmEtdGltZXMnOiBzdGF0ZS5zdGF0dXMgPT09ICdGQUlMRUQnLFxyXG4gICAgICAgICAgICAgICAgICAgICdmYS1jaXJjbGUnOiBzdGF0ZS5zdGF0dXMgPT09ICdOT1RfU1RBUlRFRCdcclxuICAgICAgICAgICAgICAgIH1cIj48L2VtPiA8L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHRcIiAqbmdJZj1cIm9wdGlvbnMuaXNNdWx0aVdvcmRTdGFnZU5hbWVcIj57e3N0YXRlLm5hbWUgfCBmb3JtYXRUZXh0IDogb3B0aW9ucy50ZXh0U2VwYXJhdG9yfX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHRcIiAqbmdJZj1cIiFvcHRpb25zLmlzTXVsdGlXb3JkU3RhZ2VOYW1lXCI+e3tzdGF0ZS5uYW1lfX08L3NwYW4+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RlcFwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpY29uXCJcclxuICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdqb2Itc3VjY2Vzcyc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJyAmJiBzdGF0ZXNbdGhpcy5zdGF0ZXMubGVuZ3RoIC0gMV0uc3RhdHVzID09PSAnQ09NUExFVEVEJyApLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQtd2hpdGUnOiAoam9iT3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnam9iLWZhaWxlZCc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnRkFJTEVEJylcclxuICAgICAgICAgICAgICAgICAgICB9XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY2xpcGJvYXJkLWNoZWNrXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJ1wiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtdGltZXNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdGQUlMRUQnXCI+PC9lbT5cclxuICAgICAgICAgICAgICAgICAgICA8ZW0gY2xhc3M9XCJmYSBmYS1jbGlwYm9hcmQtY2hlY2tcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdBQ1RJVkUnICYmIHN0YXRlc1t0aGlzLnN0YXRlcy5sZW5ndGggLSAxXS5zdGF0dXMgIT0gJ0NPTVBMRVRFRCcgIFwiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY29nIGZhLXNwaW4gdGV4dC1tdXRlZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiam9iT3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScgJiYgc3RhdGVzW3RoaXMuc3RhdGVzLmxlbmd0aCAtIDFdLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcgXCI+PC9lbT5cclxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiPiB7e29wdGlvbnMuZmluYWxTdGFnZU5hbWV9fSA8L3NwYW4+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbjwvZGl2PlxyXG48IS0tIElmIHVzZXIgd2FudHMgTG9ncyB0byBkaXNwbGF5IC0tPlxyXG48ZGl2IGNsYXNzPVwicm93IG10LTJcIiAgKm5nSWY9XCJvcHRpb25zLnNob3dMb2dzXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTEyXCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInNoYWRvdy1ub25lXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWhlYWRlclwiPlxyXG4gICAgICAgICAgICAgICAgPGgzIGNsYXNzPVwiY2FyZC10aXRsZVwiPkV2ZW50cyBhbmQgTG9nczwvaDM+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ib2R5IHAtMCBlbGV2YXRpb24tMSB0YWJsZS1yZXNwb25zaXZlXCI+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZC1mb290ZXJcIj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuPC9kaXY+Il19