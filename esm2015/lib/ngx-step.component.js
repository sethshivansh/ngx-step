import { Component, Input } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./stageformatter.pipe";
export class NgxStepComponent {
    constructor() {
        this.updateProgressLogs = [];
        this.stages = [1, 2, 3, 4, 5];
        this.jobOverallStatus = 'NOT_STARTED'; // Possible Values- NOT_STARTED , ACTIVE, COMPLETED, FAILED
        this.options = {
            type: 'BASIC',
            excludeFirstEntry: false,
            showLogs: false,
            finalStageName: 'FINISH',
            isMultiWordStageName: false,
            textSeparator: '_'
        };
        this.states = [];
    }
    ngOnChanges(changes) {
        this.ngOnInit();
    }
    ngOnInit() {
        this.generateStages();
    }
    generateStages() {
        if (this.options.type === 'CUSTOM') {
            let result = this.groupBy(this.updateProgressLogs.updateInfo, (obj) => obj.stage);
            if (this.states.length > 0) {
                this.states = []; //reset previous states data 
            }
            this.stages.forEach((item, index) => {
                var element = item.name ? item.name : item;
                if (element in result) {
                    let stageStatus = result[element][result[element].length - 1].status;
                    this.states.push({ 'name': element, 'status': stageStatus });
                }
                else {
                    // Then take the value from the updateInfo object
                    if (index <= 0) {
                        this.states.push({ 'name': element, 'status': 'IN_PROGRESS' });
                    }
                    else {
                        // Check if previous stage of not found element is completed then make the not found stage at position 'index' status as IN_PROGRESS else 'NOT_STARTED'.
                        var previousStateStatus = this.states[index - 1].status;
                        var newStatusForNotFoundStage = previousStateStatus === 'COMPLETED' ? 'IN_PROGRESS' : 'NOT_STARTED';
                        this.states.push({ 'name': element, 'status': newStatusForNotFoundStage });
                    }
                }
            });
        }
    }
    groupBy(array, key) {
        const keyFn = key instanceof Function ? key : (obj) => obj[key];
        return array.reduce((objectsByKeyValue, obj) => {
            const value = keyFn(obj);
            objectsByKeyValue[value] = (objectsByKeyValue[value] || []).concat(obj);
            return objectsByKeyValue;
        }, {});
    }
}
NgxStepComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: NgxStepComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
NgxStepComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: NgxStepComponent, selector: "ngx-step", inputs: { updateProgressLogs: "updateProgressLogs", stages: "stages", jobOverallStatus: "jobOverallStatus", options: "options" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"row mt-2\" style=\"overflow: hidden !important;\" *ngIf=\"options.type === 'BASIC'\">\r\n    <div class=\"col-md-12 col-sm-12 job-progress-bar p-0 bg-white\">\r\n        <div class=\"track\" *ngIf=\"stages.length >0\">\r\n            <div class=\"step\" [ngClass]=\"state.status\" *ngFor=\"let state of stages; let i = index\">\r\n                <span class=\"icon\"> <em class=\"fas\" [ngClass]=\"{\r\n                    'fa-check': state.status === 'COMPLETED',\r\n                    'fa-sync fa-spin': state.status === 'IN_PROGRESS',\r\n                    'fa-times': state.status === 'FAILED',\r\n                    'fa-circle': state.status === 'NOT_STARTED'\r\n                }\"></em> </span>\r\n                <span class=\"text\" *ngIf=\"options.isMultiWordStageName\">{{state.name | formatText : options.textSeparator}}</span>\r\n                <span class=\"text\" *ngIf=\"!options.isMultiWordStageName\">{{state.name}}</span>\r\n\r\n            </div>\r\n            <div class=\"step\">\r\n                <span class=\"icon\"\r\n                    [ngClass]=\"{\r\n                        'job-success': (jobOverallStatus === 'COMPLETED' && states[this.states.length - 1].status === 'COMPLETED' ), \r\n                        'text-white': (jobOverallStatus === 'ACTIVE'),\r\n                        'job-failed': (jobOverallStatus === 'FAILED')\r\n                    }\">\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'COMPLETED'\"></em>\r\n                    <em class=\"fa fa-times\"\r\n                        *ngIf=\"jobOverallStatus === 'FAILED'\"></em>\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && states[this.states.length - 1].status != 'COMPLETED'  \"></em>\r\n                    <em class=\"fa fa-cog fa-spin text-muted\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && states[this.states.length - 1].status === 'COMPLETED' \"></em>\r\n                </span>\r\n                <span class=\"text\"> \r\n                    {{options.finalStageName}}\r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"row mt-2\" style=\"overflow: hidden !important;\" *ngIf=\"options.type === 'CUSTOM'\">\r\n    <div class=\"col-md-12 col-sm-12 job-progress-bar p-0 bg-white\">\r\n        <div class=\"track\" *ngIf=\"states.length >0\">\r\n            <div class=\"step\" [ngClass]=\"state.status\" *ngFor=\"let state of states; let i = index\">\r\n                <span class=\"icon\"> <em class=\"fas\" [ngClass]=\"{\r\n                    'fa-check': state.status === 'COMPLETED',\r\n                    'fa-sync fa-spin': state.status === 'IN_PROGRESS',\r\n                    'fa-times': state.status === 'FAILED',\r\n                    'fa-circle': state.status === 'NOT_STARTED'\r\n                }\"></em> </span>\r\n                <span class=\"text\" *ngIf=\"options.isMultiWordStageName\">{{state.name | formatText : options.textSeparator}}</span>\r\n                <span class=\"text\" *ngIf=\"!options.isMultiWordStageName\">{{state.name}}</span>\r\n            </div>\r\n            <div class=\"step\">\r\n                <span class=\"icon\"\r\n                    [ngClass]=\"{\r\n                        'job-success': (jobOverallStatus === 'COMPLETED' && states[this.states.length - 1].status === 'COMPLETED' ), \r\n                        'text-white': (jobOverallStatus === 'ACTIVE'),\r\n                        'job-failed': (jobOverallStatus === 'FAILED')\r\n                    }\">\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'COMPLETED'\"></em>\r\n                    <em class=\"fa fa-times\"\r\n                        *ngIf=\"jobOverallStatus === 'FAILED'\"></em>\r\n                    <em class=\"fa fa-clipboard-check\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && states[this.states.length - 1].status != 'COMPLETED'  \"></em>\r\n                    <em class=\"fa fa-cog fa-spin text-muted\"\r\n                        *ngIf=\"jobOverallStatus === 'ACTIVE' && states[this.states.length - 1].status === 'COMPLETED' \"></em>\r\n                </span>\r\n                <span class=\"text\"> \r\n                    {{options.finalStageName}} \r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- If user wants Logs to display -->\r\n<div class=\"row mt-2\"  *ngIf=\"options.showLogs\">\r\n    <div class=\"col-md-12\">\r\n        <div class=\"shadow-none\">\r\n            <div class=\"card-header\">\r\n                <h3 class=\"card-title\">Events and Logs</h3>\r\n            </div>\r\n            <div class=\"card-body p-0 elevation-1 table-responsive\">\r\n            </div>\r\n            <div class=\"card-footer\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>", styles: [".wd-100px{width:100px}.wd-150px{width:150px}.label-name{font-weight:500}:host ::ng-deep .last-edited-step-1 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-1 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-2 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):after,:host ::ng-deep .last-edited-step-3 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):before,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):after,:host ::ng-deep .last-edited-step-4 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(9):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(1):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(3):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(5):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(7):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(9):before,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(11):after,:host ::ng-deep .last-edited-step-5 .mat-horizontal-stepper-header-container .mat-step-header:nth-child(13):before{border-top-color:#7e8a8a!important}.track{position:relative;display:flex;margin-bottom:40px;margin-top:50px}.track .step{flex-grow:1;width:25%;margin-top:-13px;text-align:center;position:relative}.track .step.active:before{background:#FF5722}.track .step:before{height:5px;position:absolute;content:\"\";width:100%;top:13px}.track .step.active .icon{background:#ee5435;color:#fff}.track .icon{display:inline-block;width:30px;height:30px;line-height:30px;position:relative;border-radius:100%;background:#ddd}.track .step.active .text{font-weight:400;color:#000}.track .text{display:block;margin-top:7px;font-size:12px}.track .step.COMPLETED:before{background:#16b587}.track .step.COMPLETED .icon{background:#16b587;color:#fff}.track .step.COMPLETED .text{font-weight:400;color:#000}.track .step.FAILED:before{background:#f40c48}.track .step.FAILED .icon{background:#f40c48;color:#fff}.track .step.FAILED .text{font-weight:400;color:#f40c48}.track .step.IN_PROGRESS:before{background:#eab417}.track .step.IN_PROGRESS .icon{background:#eab417;color:#fff}.track .step.IN_PROGRESS .text{font-weight:500;color:#000}.track .step.NOT_STARTED:before{background:#dddddd}.track .step.NOT_STARTED .icon{color:#fff}.track .step.NOT_STARTED .text{font-weight:400;color:#6c757d}.job-success{background:#16b587!important;color:#fff}.job-failed{background:#f40c48!important;color:#fff}.removed-node{opacity:.3}.job-create{background-color:#1eb980;text-transform:uppercase}.job-delete{background-color:#f8d7da;text-transform:uppercase}.job-upgrade{background-color:#eab417;text-transform:uppercase}.job-scaleup{background-color:#015a92;text-transform:uppercase;color:#fff}.job-scale-down{background-color:#ccc;text-transform:uppercase}\n"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], pipes: { "formatText": i2.StageFormatterPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: NgxStepComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngx-step',
                    templateUrl: 'ngx-step.html',
                    styleUrls: ['ngx-step.css']
                }]
        }], ctorParameters: function () { return []; }, propDecorators: { updateProgressLogs: [{
                type: Input
            }], stages: [{
                type: Input
            }], jobOverallStatus: [{
                type: Input
            }], options: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXN0ZXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXN0ZXAvc3JjL2xpYi9uZ3gtc3RlcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc3RlcC9zcmMvbGliL25neC1zdGVwLmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQXNDLE1BQU0sZUFBZSxDQUFDOzs7O0FBUTdGLE1BQU0sT0FBTyxnQkFBZ0I7SUFlM0I7UUFkUyx1QkFBa0IsR0FBUSxFQUFFLENBQUU7UUFDOUIsV0FBTSxHQUFRLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLHFCQUFnQixHQUFRLGFBQWEsQ0FBQyxDQUFDLDJEQUEyRDtRQUNsRyxZQUFPLEdBQU87WUFDckIsSUFBSSxFQUFFLE9BQU87WUFDYixpQkFBaUIsRUFBRSxLQUFLO1lBQ3hCLFFBQVEsRUFBRSxLQUFLO1lBQ2YsY0FBYyxFQUFFLFFBQVE7WUFDeEIsb0JBQW9CLEVBQUcsS0FBSztZQUM1QixhQUFhLEVBQUUsR0FBRztTQUNuQixDQUFDO1FBRUYsV0FBTSxHQUFRLEVBQUUsQ0FBQztJQUVELENBQUM7SUFDakIsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQsY0FBYztRQUNaLElBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssUUFBUSxFQUFDO1lBQ2hDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxDQUFDLEdBQU8sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RGLElBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFDO2dCQUN4QixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQyxDQUFDLDZCQUE2QjthQUNoRDtZQUNELElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBUSxFQUFFLEtBQVMsRUFBRSxFQUFFO2dCQUMxQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUU7Z0JBQzVDLElBQUcsT0FBTyxJQUFJLE1BQU0sRUFBQztvQkFDbkIsSUFBSSxXQUFXLEdBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO29CQUNwRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFDLE1BQU0sRUFBQyxPQUFPLEVBQUMsUUFBUSxFQUFDLFdBQVcsRUFBQyxDQUFDLENBQUM7aUJBQ3pEO3FCQUFJO29CQUNILGlEQUFpRDtvQkFDakQsSUFBRyxLQUFLLElBQUksQ0FBQyxFQUFDO3dCQUNaLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFDLE9BQU8sRUFBQyxRQUFRLEVBQUMsYUFBYSxFQUFDLENBQUMsQ0FBQztxQkFDM0Q7eUJBQUk7d0JBQ0gsd0pBQXdKO3dCQUN2SixJQUFJLG1CQUFtQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQzt3QkFDdEQsSUFBSSx5QkFBeUIsR0FBRyxtQkFBbUIsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDO3dCQUNwRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFDLE1BQU0sRUFBQyxPQUFPLEVBQUMsUUFBUSxFQUFDLHlCQUF5QixFQUFDLENBQUMsQ0FBQztxQkFDdEU7aUJBQ0o7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVELE9BQU8sQ0FBQyxLQUFTLEVBQUUsR0FBTztRQUN4QixNQUFNLEtBQUssR0FBRyxHQUFHLFlBQVksUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBTyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEUsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsaUJBQXFCLEVBQUUsR0FBTyxFQUFFLEVBQUU7WUFDckQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3hFLE9BQU8saUJBQWlCLENBQUM7UUFDM0IsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1QsQ0FBQzs7OEdBekRVLGdCQUFnQjtrR0FBaEIsZ0JBQWdCLHVNQ1I3Qiw2NkpBdUZNOzRGRC9FTyxnQkFBZ0I7a0JBTDVCLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLFdBQVcsRUFBRSxlQUFlO29CQUM1QixTQUFTLEVBQUUsQ0FBQyxjQUFjLENBQUM7aUJBQzVCOzBFQUVVLGtCQUFrQjtzQkFBMUIsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csZ0JBQWdCO3NCQUF4QixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT25DaGFuZ2VzLFZpZXdDaGlsZCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1zdGVwJyxcbiAgdGVtcGxhdGVVcmw6ICduZ3gtc3RlcC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ25neC1zdGVwLmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIE5neFN0ZXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICBASW5wdXQoKSB1cGRhdGVQcm9ncmVzc0xvZ3M6IGFueSA9IFtdIDtcbiAgQElucHV0KCkgc3RhZ2VzIDphbnkgPSBbMSwyLDMsNCw1XTtcbiAgQElucHV0KCkgam9iT3ZlcmFsbFN0YXR1cyA6YW55ID0gJ05PVF9TVEFSVEVEJzsgLy8gUG9zc2libGUgVmFsdWVzLSBOT1RfU1RBUlRFRCAsIEFDVElWRSwgQ09NUExFVEVELCBGQUlMRURcbiAgQElucHV0KCkgb3B0aW9uczphbnkgPSB7XG4gICAgdHlwZTogJ0JBU0lDJywvL0NVU1RPTSAtIHlvdSBuZWVkIHRvIGdlbmVyYXRlIHN0YWdlcyBhbmQgaXRzXG4gICAgZXhjbHVkZUZpcnN0RW50cnk6IGZhbHNlLFxuICAgIHNob3dMb2dzOiBmYWxzZSxcbiAgICBmaW5hbFN0YWdlTmFtZTogJ0ZJTklTSCcsXG4gICAgaXNNdWx0aVdvcmRTdGFnZU5hbWUgOiBmYWxzZSxcbiAgICB0ZXh0U2VwYXJhdG9yOiAnXydcbiAgfTtcblxuICBzdGF0ZXM6IGFueSA9IFtdO1xuICBcbiAgY29uc3RydWN0b3IoKSB7IH1cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIHRoaXMubmdPbkluaXQoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZ2VuZXJhdGVTdGFnZXMoKTtcbiAgfVxuXG4gIGdlbmVyYXRlU3RhZ2VzKCl7XG4gICAgaWYodGhpcy5vcHRpb25zLnR5cGUgPT09ICdDVVNUT00nKXtcbiAgICAgIGxldCByZXN1bHQgPSB0aGlzLmdyb3VwQnkodGhpcy51cGRhdGVQcm9ncmVzc0xvZ3MudXBkYXRlSW5mbywgKG9iajphbnkpID0+IG9iai5zdGFnZSk7XG4gICAgICBpZih0aGlzLnN0YXRlcy5sZW5ndGggPiAwKXtcbiAgICAgICAgdGhpcy5zdGF0ZXMgPSBbXTsgLy9yZXNldCBwcmV2aW91cyBzdGF0ZXMgZGF0YSBcbiAgICAgIH1cbiAgICAgIHRoaXMuc3RhZ2VzLmZvckVhY2goKGl0ZW06YW55LCBpbmRleDphbnkpID0+IHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBpdGVtLm5hbWUgPyBpdGVtLm5hbWUgOiBpdGVtIDtcbiAgICAgICAgaWYoZWxlbWVudCBpbiByZXN1bHQpe1xuICAgICAgICAgIGxldCBzdGFnZVN0YXR1cyA9ICByZXN1bHRbZWxlbWVudF1bcmVzdWx0W2VsZW1lbnRdLmxlbmd0aC0xXS5zdGF0dXM7XG4gICAgICAgICAgdGhpcy5zdGF0ZXMucHVzaCh7J25hbWUnOmVsZW1lbnQsJ3N0YXR1cyc6c3RhZ2VTdGF0dXN9KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgLy8gVGhlbiB0YWtlIHRoZSB2YWx1ZSBmcm9tIHRoZSB1cGRhdGVJbmZvIG9iamVjdFxuICAgICAgICAgIGlmKGluZGV4IDw9IDApe1xuICAgICAgICAgICAgdGhpcy5zdGF0ZXMucHVzaCh7J25hbWUnOmVsZW1lbnQsJ3N0YXR1cyc6J0lOX1BST0dSRVNTJ30pO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgcHJldmlvdXMgc3RhZ2Ugb2Ygbm90IGZvdW5kIGVsZW1lbnQgaXMgY29tcGxldGVkIHRoZW4gbWFrZSB0aGUgbm90IGZvdW5kIHN0YWdlIGF0IHBvc2l0aW9uICdpbmRleCcgc3RhdHVzIGFzIElOX1BST0dSRVNTIGVsc2UgJ05PVF9TVEFSVEVEJy5cbiAgICAgICAgICAgICB2YXIgcHJldmlvdXNTdGF0ZVN0YXR1cyA9IHRoaXMuc3RhdGVzW2luZGV4LTFdLnN0YXR1cztcbiAgICAgICAgICAgICB2YXIgbmV3U3RhdHVzRm9yTm90Rm91bmRTdGFnZSA9IHByZXZpb3VzU3RhdGVTdGF0dXMgPT09ICdDT01QTEVURUQnID8gJ0lOX1BST0dSRVNTJyA6ICdOT1RfU1RBUlRFRCc7IFxuICAgICAgICAgICAgIHRoaXMuc3RhdGVzLnB1c2goeyduYW1lJzplbGVtZW50LCdzdGF0dXMnOm5ld1N0YXR1c0Zvck5vdEZvdW5kU3RhZ2V9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ3JvdXBCeShhcnJheTphbnksIGtleTphbnkpIHtcbiAgICBjb25zdCBrZXlGbiA9IGtleSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8ga2V5IDogKG9iajphbnkpID0+IG9ialtrZXldO1xuICAgIHJldHVybiBhcnJheS5yZWR1Y2UoKG9iamVjdHNCeUtleVZhbHVlOmFueSwgb2JqOmFueSkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBrZXlGbihvYmopO1xuICAgICAgb2JqZWN0c0J5S2V5VmFsdWVbdmFsdWVdID0gKG9iamVjdHNCeUtleVZhbHVlW3ZhbHVlXSB8fCBbXSkuY29uY2F0KG9iaik7XG4gICAgICByZXR1cm4gb2JqZWN0c0J5S2V5VmFsdWU7XG4gICAgfSwge30pO1xuICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJyb3cgbXQtMlwiIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbiAhaW1wb3J0YW50O1wiICpuZ0lmPVwib3B0aW9ucy50eXBlID09PSAnQkFTSUMnXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTEyIGNvbC1zbS0xMiBqb2ItcHJvZ3Jlc3MtYmFyIHAtMCBiZy13aGl0ZVwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0cmFja1wiICpuZ0lmPVwic3RhZ2VzLmxlbmd0aCA+MFwiPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RlcFwiIFtuZ0NsYXNzXT1cInN0YXRlLnN0YXR1c1wiICpuZ0Zvcj1cImxldCBzdGF0ZSBvZiBzdGFnZXM7IGxldCBpID0gaW5kZXhcIj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaWNvblwiPiA8ZW0gY2xhc3M9XCJmYXNcIiBbbmdDbGFzc109XCJ7XHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZhLWNoZWNrJzogc3RhdGUuc3RhdHVzID09PSAnQ09NUExFVEVEJyxcclxuICAgICAgICAgICAgICAgICAgICAnZmEtc3luYyBmYS1zcGluJzogc3RhdGUuc3RhdHVzID09PSAnSU5fUFJPR1JFU1MnLFxyXG4gICAgICAgICAgICAgICAgICAgICdmYS10aW1lcyc6IHN0YXRlLnN0YXR1cyA9PT0gJ0ZBSUxFRCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZhLWNpcmNsZSc6IHN0YXRlLnN0YXR1cyA9PT0gJ05PVF9TVEFSVEVEJ1xyXG4gICAgICAgICAgICAgICAgfVwiPjwvZW0+IDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiICpuZ0lmPVwib3B0aW9ucy5pc011bHRpV29yZFN0YWdlTmFtZVwiPnt7c3RhdGUubmFtZSB8IGZvcm1hdFRleHQgOiBvcHRpb25zLnRleHRTZXBhcmF0b3J9fTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiICpuZ0lmPVwiIW9wdGlvbnMuaXNNdWx0aVdvcmRTdGFnZU5hbWVcIj57e3N0YXRlLm5hbWV9fTwvc3Bhbj5cclxuXHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RlcFwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpY29uXCJcclxuICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdqb2Itc3VjY2Vzcyc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJyAmJiBzdGF0ZXNbdGhpcy5zdGF0ZXMubGVuZ3RoIC0gMV0uc3RhdHVzID09PSAnQ09NUExFVEVEJyApLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQtd2hpdGUnOiAoam9iT3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnam9iLWZhaWxlZCc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnRkFJTEVEJylcclxuICAgICAgICAgICAgICAgICAgICB9XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY2xpcGJvYXJkLWNoZWNrXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJ1wiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtdGltZXNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdGQUlMRUQnXCI+PC9lbT5cclxuICAgICAgICAgICAgICAgICAgICA8ZW0gY2xhc3M9XCJmYSBmYS1jbGlwYm9hcmQtY2hlY2tcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdBQ1RJVkUnICYmIHN0YXRlc1t0aGlzLnN0YXRlcy5sZW5ndGggLSAxXS5zdGF0dXMgIT0gJ0NPTVBMRVRFRCcgIFwiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY29nIGZhLXNwaW4gdGV4dC1tdXRlZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiam9iT3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScgJiYgc3RhdGVzW3RoaXMuc3RhdGVzLmxlbmd0aCAtIDFdLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcgXCI+PC9lbT5cclxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiPiBcclxuICAgICAgICAgICAgICAgICAgICB7e29wdGlvbnMuZmluYWxTdGFnZU5hbWV9fVxyXG4gICAgICAgICAgICAgICAgPC9zcGFuPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG48L2Rpdj5cclxuXHJcbjxkaXYgY2xhc3M9XCJyb3cgbXQtMlwiIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbiAhaW1wb3J0YW50O1wiICpuZ0lmPVwib3B0aW9ucy50eXBlID09PSAnQ1VTVE9NJ1wiPlxyXG4gICAgPGRpdiBjbGFzcz1cImNvbC1tZC0xMiBjb2wtc20tMTIgam9iLXByb2dyZXNzLWJhciBwLTAgYmctd2hpdGVcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwidHJhY2tcIiAqbmdJZj1cInN0YXRlcy5sZW5ndGggPjBcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN0ZXBcIiBbbmdDbGFzc109XCJzdGF0ZS5zdGF0dXNcIiAqbmdGb3I9XCJsZXQgc3RhdGUgb2Ygc3RhdGVzOyBsZXQgaSA9IGluZGV4XCI+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImljb25cIj4gPGVtIGNsYXNzPVwiZmFzXCIgW25nQ2xhc3NdPVwie1xyXG4gICAgICAgICAgICAgICAgICAgICdmYS1jaGVjayc6IHN0YXRlLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ZhLXN5bmMgZmEtc3Bpbic6IHN0YXRlLnN0YXR1cyA9PT0gJ0lOX1BST0dSRVNTJyxcclxuICAgICAgICAgICAgICAgICAgICAnZmEtdGltZXMnOiBzdGF0ZS5zdGF0dXMgPT09ICdGQUlMRUQnLFxyXG4gICAgICAgICAgICAgICAgICAgICdmYS1jaXJjbGUnOiBzdGF0ZS5zdGF0dXMgPT09ICdOT1RfU1RBUlRFRCdcclxuICAgICAgICAgICAgICAgIH1cIj48L2VtPiA8L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHRcIiAqbmdJZj1cIm9wdGlvbnMuaXNNdWx0aVdvcmRTdGFnZU5hbWVcIj57e3N0YXRlLm5hbWUgfCBmb3JtYXRUZXh0IDogb3B0aW9ucy50ZXh0U2VwYXJhdG9yfX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHRcIiAqbmdJZj1cIiFvcHRpb25zLmlzTXVsdGlXb3JkU3RhZ2VOYW1lXCI+e3tzdGF0ZS5uYW1lfX08L3NwYW4+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RlcFwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpY29uXCJcclxuICAgICAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdqb2Itc3VjY2Vzcyc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJyAmJiBzdGF0ZXNbdGhpcy5zdGF0ZXMubGVuZ3RoIC0gMV0uc3RhdHVzID09PSAnQ09NUExFVEVEJyApLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQtd2hpdGUnOiAoam9iT3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnam9iLWZhaWxlZCc6IChqb2JPdmVyYWxsU3RhdHVzID09PSAnRkFJTEVEJylcclxuICAgICAgICAgICAgICAgICAgICB9XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY2xpcGJvYXJkLWNoZWNrXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJqb2JPdmVyYWxsU3RhdHVzID09PSAnQ09NUExFVEVEJ1wiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtdGltZXNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdGQUlMRUQnXCI+PC9lbT5cclxuICAgICAgICAgICAgICAgICAgICA8ZW0gY2xhc3M9XCJmYSBmYS1jbGlwYm9hcmQtY2hlY2tcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cImpvYk92ZXJhbGxTdGF0dXMgPT09ICdBQ1RJVkUnICYmIHN0YXRlc1t0aGlzLnN0YXRlcy5sZW5ndGggLSAxXS5zdGF0dXMgIT0gJ0NPTVBMRVRFRCcgIFwiPjwvZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPGVtIGNsYXNzPVwiZmEgZmEtY29nIGZhLXNwaW4gdGV4dC1tdXRlZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiam9iT3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScgJiYgc3RhdGVzW3RoaXMuc3RhdGVzLmxlbmd0aCAtIDFdLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcgXCI+PC9lbT5cclxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGV4dFwiPiBcclxuICAgICAgICAgICAgICAgICAgICB7e29wdGlvbnMuZmluYWxTdGFnZU5hbWV9fSBcclxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuPC9kaXY+XHJcbjwhLS0gSWYgdXNlciB3YW50cyBMb2dzIHRvIGRpc3BsYXkgLS0+XHJcbjxkaXYgY2xhc3M9XCJyb3cgbXQtMlwiICAqbmdJZj1cIm9wdGlvbnMuc2hvd0xvZ3NcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtMTJcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwic2hhZG93LW5vbmVcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtaGVhZGVyXCI+XHJcbiAgICAgICAgICAgICAgICA8aDMgY2xhc3M9XCJjYXJkLXRpdGxlXCI+RXZlbnRzIGFuZCBMb2dzPC9oMz5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHkgcC0wIGVsZXZhdGlvbi0xIHRhYmxlLXJlc3BvbnNpdmVcIj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWZvb3RlclwiPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG48L2Rpdj4iXX0=